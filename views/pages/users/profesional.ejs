<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de Administrador</title>
    <link rel="stylesheet" href="../../../public/estilos/estilos_de_paginas.css" />
    <link rel="stylesheet" href="../../../public/estilos/profesional.css" />
    <link rel="icon" href="./media/imagenes/icono.ico"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

        <style>
        
    </style>

</head>

<body>
     <header class="encabezado" style="display: flex; justify-content: space-between; align-items: center; padding: 20px 30px;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <img src="../../../public/media/imagenes/logo-sentirse-bien.png" alt="Logo Sentirse Bien" style="height: 60px; border-radius: 15px;">
                <div style="color: white;">
                    <h1 style="margin: 0;">Sentirse Bien</h1>
                    <p style="margin: 0;">Bienestar pensado para vos</p>
                </div>
            </div>
            <div style="color: white; font-weight: bold;" id="saludoAdmin">Hola, Profesional!</div>
            <button id="cerrarSesion" class="boton-acento">Cerrar sesi√≥n</button>
            <script>
                const botonCerrarSesion = document.getElementById("cerrarSesion");
                if (botonCerrarSesion) {
                botonCerrarSesion.addEventListener("click", () => {
                    localStorage.removeItem("usuarioLogueado");
                    window.location.href = "../../Formularios/inicioSesion.html";
                });
                }
            </script>
        </header>

    <main class="contenedor-profesional">
        <section class="encabezado-profesional">
        <h2>Turnos del d√≠a</h2>
        <p id="fechaHoy"></p>
        </section>

        <div class="barra-filtros">
            <label for="filtroCategoria">Filtrar por categor√≠a:</label>
            <select id="filtroCategoria">
            <option value="todas">Todas</option>
            <option value="masajes">Masajes</option>
            <option value="belleza">Belleza</option>
            <option value="faciales">Faciales</option>
            <option value="corporales">Corporales</option>
            <option value="grupales">Grupales</option>
            </select>

            <label for="filtroEstado">Filtrar por estado:</label>
            <select id="filtroEstado">
            <option value="todos">Todos</option>
            <option value="pendiente">Pendiente</option>
            <option value="en curso">En curso</option>
            <option value="finalizado">Finalizado</option>
            <option value="cancelado">Cancelado</option>
            </select>

            <label for="filtroFecha">Filtrar por fecha:</label>
            <input type="date" id="filtroFecha" />

            <button onclick="descargarTurnosPDF()" class="btn-descargar">üìÑ Descargar PDF</button>


            <button onclick="imprimirTodos()" class="btn-imprimir-todos">üñ®Ô∏è Imprimir todos</button>
        </div>

        <div id="contenedorTurnos" class="grid-turnos"></div>
    </main>

    <style>
    .contenedor-profesional {
        padding: 30px;
        background: #fefefe;
        max-width: 1000px;
        margin: auto;
    }

    .barra-filtros {
        display: flex;
        gap: 15px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
    }

    .grid-turnos {
        display: grid;
        gap: 20px;
    }

   .tarjeta-turno {
    background: #fff;
    border-radius: 12px;
    border-left: 5px solid var(--color-primario);
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.07);
    transition: transform 0.3s ease;
    }

    .tarjeta-turno:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 14px rgba(0,0,0,0.1);
    }

    .tarjeta-turno h4 {
    margin: 0 0 10px;
    color: var(--color-primario);
    font-size: 1.2rem;
    }

    .tarjeta-turno p {
    margin: 5px 0;
    color: #444;
    }


    .btn-imprimir, .btn-imprimir-todos {
        background: var(--color-primario);
        color: white;
        padding: 6px 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.9rem;
    }

    .btn-imprimir:hover, .btn-imprimir-todos:hover {
        background: var(--color-secundario);
    }
    </style>

<script>
    const turnosDelDia = [
      {
        id: 1,
        cliente_nombre: "Laura G√≥mez",
        numero_cliente: "1234",
        telefono: "3624567890",
        correo: "laura@gmail.com",
        servicio: "Masaje Anti-Stress",
        categoria: "masajes",
        hora: "10:00",
        estado: "pendiente",
        fecha: new Date().toISOString().split('T')[0]
      },
      {
        id: 2,
        cliente_nombre: "Mart√≠n D√≠az",
        numero_cliente: "1235",
        telefono: "3624123456",
        correo: "martin@gmail.com",
        servicio: "Criofrecuencia facial",
        categoria: "faciales",
        hora: "12:00",
        estado: "en curso",
        fecha: new Date().toISOString().split('T')[0]
      }
    ];

    const estadoColor = {
      pendiente: "#ffcc00",
      "en curso": "#3498db",
      finalizado: "#2ecc71",
      cancelado: "#e74c3c"
    };

    const categoriaIconos = {
      masajes: "üíÜ",
      belleza: "üíÖ",
      faciales: "üå∏",
      corporales: "üèÉ‚Äç‚ôÄÔ∏è",
      grupales: "üë•"
    };

    function renderizarTurnos(cat = "todas", estado = "todos", fecha = null) {
      const contenedor = document.getElementById("contenedorTurnos");
      contenedor.innerHTML = "";

      const filtrados = turnosDelDia.filter(t => {
        const matchCat = cat === "todas" || t.categoria === cat;
        const matchEst = estado === "todos" || t.estado === estado;
        const matchFecha = !fecha || t.fecha === fecha;
        return matchCat && matchEst && matchFecha;
      });

      if (filtrados.length === 0) {
        contenedor.innerHTML = "<p>No hay turnos para mostrar.</p>";
        return;
      }

      filtrados.forEach(t => {
        const div = document.createElement("div");
        div.className = "tarjeta-turno";
        div.style.borderLeft = `6px solid ${estadoColor[t.estado]}`;

        const icono = categoriaIconos[t.categoria] || "‚ùî";
        div.innerHTML = `
          <h4>${icono} ${t.servicio} - ${t.hora}</h4>
          <p><strong>Cliente:</strong> ${t.cliente_nombre}</p>
          <p><strong>N¬∞ Cliente:</strong> ${t.numero_cliente}</p>
          <p><strong>Tel√©fono:</strong> ${t.telefono}</p>
          <p><strong>Correo:</strong> ${t.correo}</p>
          <p><strong>Categor√≠a:</strong> <span class="badge">${t.categoria}</span></p>
          <p><strong>Estado:</strong> 
            <select onchange="actualizarEstado(${t.id}, this.value)">
              ${["Pendiente", "En curso", "Finalizado", "Cancelado"].map(e =>
                `<option value="${e}" ${t.estado === e ? "selected" : ""}>${e}</option>`
              ).join("")}
            </select>
          </p>
          <button class="btn-imprimir" onclick="imprimirTurno(${t.id})">üñ®Ô∏è Imprimir</button>
          <a class="btn-whatsapp" target="_blank"
            href="https://wa.me/54${t.telefono}?text=Hola%20${encodeURIComponent(t.cliente_nombre)}%2C%20te%20contacto%20desde%20Sentirse%20Bien%20por%20tu%20turno%20de%20${encodeURIComponent(t.servicio)}">
            üí¨ WhatsApp
          </a>
        `;
        contenedor.appendChild(div);
      });
    }

    function actualizarEstado(id, nuevoEstado) {
      const turno = turnosDelDia.find(t => t.id === id);
      if (turno) turno.estado = nuevoEstado;
      renderizarTurnos(
        document.getElementById("filtroCategoria").value,
        document.getElementById("filtroEstado").value,
        document.getElementById("filtroFecha").value || null
      );
    }

    function imprimirTurno(id) {
      const t = turnosDelDia.find(t => t.id === id);
      if (!t) return;
      const w = window.open("", "", "width=600,height=600");
      w.document.write(`<h2>Turno</h2>
        <p><strong>Cliente:</strong> ${t.cliente_nombre}</p>
        <p><strong>Servicio:</strong> ${t.servicio}</p>
        <p><strong>Hora:</strong> ${t.hora}</p>
        <p><strong>Estado:</strong> ${t.estado}</p>`);
      w.document.close();
      w.print();
    }

    function imprimirTodos() {
      const w = window.open("", "", "width=800,height=800");
      w.document.write(`<h2>Todos los turnos del d√≠a</h2>`);
      turnosDelDia.forEach(t => {
        w.document.write(`<p><strong>${t.servicio}</strong> (${t.hora}) - ${t.cliente_nombre} - Estado: ${t.estado}</p><hr>`);
      });
      w.document.close();
      w.print();
    }

    async function descargarTurnosPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFont("helvetica", "bold");
      doc.setFontSize(16);
      doc.text("Turnos del d√≠a - Sentirse Bien", 14, 20);
      doc.setFontSize(10);
      doc.setFont("helvetica", "normal");
      doc.text(`Fecha: ${new Date().toLocaleDateString("es-AR")}`, 14, 28);
      let y = 40;

      turnosDelDia.forEach((t, i) => {
        const texto = `#${i + 1}
            Cliente: ${t.cliente_nombre} (N¬∞ ${t.numero_cliente})
            Servicio: ${t.servicio}
            Hora: ${t.hora}
            Categor√≠a: ${t.categoria}
            Estado: ${t.estado}
            Tel√©fono: ${t.telefono}
            Correo: ${t.correo}`;

        const lines = doc.splitTextToSize(texto, 180);
        if (y + lines.length * 6 > 270) {
          doc.addPage();
          y = 20;
        }
        doc.text(lines, 14, y);
        y += lines.length * 6 + 4;
      });

      doc.save("turnos-dia.pdf");
    }

    function obtenerFiltrosYRenderizar() {
      renderizarTurnos(
        document.getElementById("filtroCategoria").value,
        document.getElementById("filtroEstado").value,
        document.getElementById("filtroFecha").value || null
      );
    }

    document.getElementById("filtroCategoria").addEventListener("change", obtenerFiltrosYRenderizar);
    document.getElementById("filtroEstado").addEventListener("change", obtenerFiltrosYRenderizar);
    document.getElementById("filtroFecha").addEventListener("change", obtenerFiltrosYRenderizar);

    document.getElementById("cerrarSesion").addEventListener("click", () => {
      localStorage.removeItem("usuarioLogueado");
      window.location.href = "../../Formularios/inicioSesion.html";
    });

    document.getElementById("fechaHoy").textContent = new Date().toLocaleDateString("es-AR", {
      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
    });

    renderizarTurnos();
  </script>

 <%- include("../../templates/footer.ejs"); %>
</body>
</html>